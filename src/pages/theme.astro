---
import MainLayout from "../layouts/MainLayout.astro";
import CountdownTimer from "../components/CountdownTimer.astro";
import { xataClient } from "../xataClient";

// TODO: Should read the target value from the database
const target = "2024-12-02 07:00:00";
let dest = new Date(target).getTime();
let now = new Date().getTime();
let diff = dest - now;

let themeActive = false;
let themeTitle = "";
let themeDescription = "";

if (diff <= 0) {
  await fetchTheme();
  themeActive = true;
}

async function fetchTheme() {
  // TODO: fix ts compiler error with db property not found
  const data = await xataClient.db.themes
    .filter({
      year: "2024",
    })
    .getFirst();

  themeTitle = data.name;
  themeDescription = data.description;
}
---

<MainLayout title="High Coast Game Jam - Theme">
  <div
    class="absolute inset-x-0 transform-gpu overflow-hidden blur-3xl sm:-top-80"
    aria-hidden="true"
  >
    <div
      class="relative left-[calc(50%-11rem)] aspect-[1155/678] w-[36.125rem] -translate-x-1/2 rotate-[30deg] bg-gradient-to-tr from-[#ff80b5] to-[#9089fc] opacity-30 sm:left-[calc(50%-30rem)] sm:w-[72.1875rem]"
      style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)"
    >
    </div>
  </div>
  {
    themeActive ? (
      <div class="mx-auto max-w-2xl py-32 sm:py-48 lg:py-56">
        <div class="mb-8 flex justify-center">
          <div class="relative rounded-full px-3 py-1 text-sm leading-6 text-gray-300">
            Unlock your creativity with 2024 year's theme.
          </div>
        </div>
        <div class="text-center">
          <h1 class="text-4xl font-bold tracking-tight text-white sm:text-6xl uppercase">
            {themeTitle}
          </h1>
          <p class="mt-6 text-lg leading-8 text-gray-300 flex flex-col gap-4">
            <>
              <span>{themeDescription}</span>
              <span>Happy jamming! ðŸš€ðŸŽ®</span>
            </>
          </p>
        </div>
      </div>
    ) : (
      <div class="mx-auto max-w-2xl py-32 sm:py-48 lg:py-56">
        <div class="mb-8 flex justify-center">
          <div class="relative rounded-full px-3 py-1 text-lg leading-6 text-gray-300">
            Time until <b>2024</b> year's theme is revealed.
          </div>
        </div>
        <div class="text-center">
          <CountdownTimer target={target} />
        </div>
      </div>
    )
  }
  <div class="mx-auto max-w-2xl py-32 sm:py-48 lg:py-56">
    <div class="mb-8 flex flex-col items-center justify-center">
      <div
        class="relative rounded-full px-3 py-1 text-sm leading-6 text-gray-300"
      >
        2023 year's theme.
      </div>
    </div>
    <div class="text-center">
      <h1
        class="text-4xl font-bold tracking-tight text-white sm:text-6xl uppercase"
      >
        Only five minutes
      </h1>
      <p class="mt-6 text-lg leading-8 text-gray-300 flex flex-col gap-4">
        <span
          >Explore the significance of time in your game development journey.
          Whether it's a race against the clock, a character's limited lifespan,
          a critical power-up window, or another unique twist, interpret "Only
          Five Minutes" in your way.</span
        ><span
          >Embrace the challenge, push the boundaries, and let time become a
          central element in your game narrative.</span
        ><span>Happy jamming! ðŸš€ðŸŽ®</span>
      </p>
    </div>
  </div>
</MainLayout>
